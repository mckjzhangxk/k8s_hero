//这个CI Demo 演示
// 确保 git,docker都本机安装好！！！
// 1 下载项目
// 2 本地编译
// 3 运行项目

pipeline {
    agent any
    stages{
        stage('clone'){
            steps{
                // sh 'go version'
                // git 把所有的 都解压到/var/lib/jenkins/workspace,没有创建 jekintest
                git "https://gitee.com/mckj-zhangxk/jekintest.git"
            }
        }

        stage('build'){
            steps{
                 //sh "go build -o main1 main.go"
                 sh "./build.sh"
                 sh 'docker login -u zhangxiaokai -p Bai2021 harbor.baijiayun.com'
                 sh 'docker push harbor.baijiayun.com/sidecar/jekendemo:0.0.2'
            }
        }
        stage('run'){
            steps{
                //sh 'ls'
                sh 'docker run  --name=jekendemo-run harbor.baijiayun.com/sidecar/jekendemo:0.0.2'
                sh 'docker logs jekendemo-run'
            }
        }
    }

}